name: Generate Release
'on':
  workflow_dispatch:
    inputs: 
       tag: 
         description: 'Release tag'
         required: true
         default: ''
         type: string

permissions:
  deployments: write

jobs:
  generate_release: 
    runs-on: ubuntu-latest  
    steps: 
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0
      - name: Setup node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: npm install
        run: |
          npm install
      - name: Generate build
        run: | 
          npm run build
      - name: Setup git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
      - name: Checkout temporary branch
        run: |
          git checkout -b release-tagging-branch
          git add -A lib/ -f
          git commit -am "Release ${{ inputs.tag }}"
      - name: Create tag
        run: | 
          git tag ${{ inputs.tag }}
      - name: Push tag
        run: | 
          git push origin ${{ inputs.tag }}
      - name: Create Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          tag: ${{ inputs.tag }}
        run: |
          gh release create "$tag" \
              --repo="$GITHUB_REPOSITORY" \
              --title="$tag" \
              --generate-notes
          